---
layout: post
title: 주식데이터(OHLC)의 Time은 언제를 기준으로 찍힐까?
date: 2020-03-28 20:48:20 +0900
description: You’ll find this post in your `_posts` directory. Go ahead and edit it and re-build the site to see your changes. # Add post description (optional)
img: stock_bars.PNG # Add image post (optional)
fig-caption: # Add figcaption (optional)
categories: "System Trading"
tags: [Stock,Quant Analysis,Backtest]
---
## 들어가기 전에
주식 데이터를 이용해 백테스트를 할 때, 종종  <b>매우 기본적이면서 중요한 내용을 깊게 생각해보지 않고 넘어가는 경우</b>가 있다.  
이번에 다룰 <b>OHLC 데이터의 Timestamp</b>도 쉽게 넘어가는 중요한 내용 중 하나이다  

## OHLC 데이터란?
일반적으로 증권사 HTS, 네이버 증권, 야후 파이낸스 등에서 데이터를 받아오게 되면, 위와 같은 형태로 제공받게 된다

    Time(시간) : 해당 데이터가 기록된 시간  
    Open(시가) : 해당 시간대의 최초로 기록된 가격  
    High(고가) : 해당 시간 내에서 기록된 가장 높은 가격  
    Low(저가) : 해당 시간 내에서 기록된 가장 낮은 가격  
    Close(종가) : 해당 시간대의 마지막에 기록된 가격

즉, 특정 시간 구간 내에서의 가격 움직임에 대한 데이터를 적어놓는 것이다

그런데 데이터에 익숙한 독자라면 이상한 것을 눈치챘을 것이다. 분명 OHLC 데이터의 한 행은 일정한 시간 범위 내에서 기록된 것인데, Time에는 딱 한 군데의 시간만이 찍혀있다. 그렇다면, 근본적인 질문이 떠오르게 된다.  
`Time이 찍힌 것은 Open시점이냐? Close시점이냐?`  

## 바로 결론으로: 분봉은 Close시점, 일봉은 Open시점 기준일 가능성이 높다.
사실 Timestamp를 언제 찍어야 하는가에 대해서 정해진 규칙은 없다(...)  
그리고 둘 중에 어느 방법이 더 우월하다고도 명확히 말하기 힘들다  
특히 요즘에는 개인도 Tick데이터를 수집해 쉽게 시간주기로 Re-Sampling 가능하기 때문에, 정말 만드는 사람 마음대로 결정될 수 있다.  
그러나 현재 주식 데이터에 대해서는, 여러가지 HTS데이터를 확인해본 결과
    
    분봉처럼 연속된 경우 =  Close기준

    일봉처럼 연속되지 않고 끊기는 경우 = Open기준

으로 기록되는 것을 볼 수 있었다. Close기준인지 Open 기준인지 확인하는 방법은 아래에서 설명하겠다

## 내가 쓰는 HTS에서 확인하는 방법
사실 가장 빠른 방법은 증권사에 전화해보는 것이다(...)  
그러나 전화를 할 수 없는 주말과 같은 경우에는 아래와 같이 HTS를 이용해 확인할 수 있다

#### 분봉
1. HTS를 실행하고 차트창을 연다
2. 단위를 1분봉으로 선택한다
3. 커서를 전일 장마감 동시호가 시작지점(15:20)으로 옮긴다
4. 만약 15:20분 데이터가 있다면, 분봉이 Close기준으로 찍히는 것이다. 15:20분 데이터는 없고 15:19분 데이터만 있다면, Open기준으로 찍히는 것이다

#### 일봉
일봉은 사실 조금만 생각해봐도 Open기준으로 잡을 수밖에 없다는 것을 알 수 있지만(당일 내에 장이 끝나니까...) 그래도 확인해보고 싶으면 아래와 같다
1. 차트창에서 단위를 일봉으로 선택한다. 누가 봐도 Open기준으로 찍혀있는 것을 확인할 수 있다.

## 이게 왜 중요한데요?
`Time 기록 시점을 잘못 생각하면, 백테스팅에서 Lookahead Bias가 일어날 수 있다`

Lookahead Bias란, 시뮬레이션 등에서 현재 시점에서 없는 정보를 이용해 현재시점의 결정을 내리게 되는 실수이다. 그야말로 백테스팅의 <b>신뢰성에 크나큰 타격을 주고</b> 실제 시스템트레이딩에서는 <b>거래 타이밍 자체를 바꾸는</b> <b>매우 중요한 실수</b>이므로, 코딩할 때 반드시 신경써야 한다.  
만약 장마감 1분 전(3시 19분)에 주식을 매입하는 전략을 수행한다고 가정해보자.  
전략에서 데이터가 Close 기준으로 기록된다고 생각한다면, 해당 전략은 3시 19분  데이터가 기록되기만을 기다릴 것이다.  
그러나 데이터가 실제로 Open기준으로 기록되고 있다면, 15:19가 작성되는 순간 이미 실제시간은 15:20이 되어 장이 종료된 시간일 것이고, 주문을 할 수 없게 될 것이다.

이처럼 데이터의 가장 기본적인 부분까지 세심하게 챙기는 것이 좋은 백테스트 결과를 낼 수 있는 기반이 될 수 있다.